import{_ as z}from"./BwZW268G.js";import{a_ as J,a1 as L,a4 as I,R as S,T as Y,H as w,I as i,K as C,aN as j,Q as v,W as P,X as G,U as h,a8 as F,aD as K,aF as Q,aE as X,a6 as r,aA as ee,$ as te,aL as ne,M as A,N as ae,Z as se,aH as re,aI as oe,a$ as ie,b0 as le,aG as ce,V as q,a2 as B,J as M,L as D,ad as ue,a7 as me,Y as de,a5 as pe,b1 as fe,ap as _e,b2 as he,al as ge}from"./D2eihLR_.js";import{_ as we}from"./QHFdKruI.js";const $={__JSPROSE_walkStop:!0},xe={};async function W(n,e){const s=await e(n);if(s===$)return $;if(s===xe)return;const t=n.children;if(t){for(const a of t.filter(Boolean))if(await W(a,e)===$)return $}}const ve=["datetime","title"],ye={__name:"NuxtTime",props:{locale:{type:String,required:!1},datetime:{type:[String,Number,Date],required:!0},localeMatcher:{type:String,required:!1},weekday:{type:String,required:!1},era:{type:String,required:!1},year:{type:String,required:!1},month:{type:String,required:!1},day:{type:String,required:!1},hour:{type:String,required:!1},minute:{type:String,required:!1},second:{type:String,required:!1},timeZoneName:{type:String,required:!1},formatMatcher:{type:String,required:!1},hour12:{type:Boolean,required:!1,default:void 0},timeZone:{type:String,required:!1},calendar:{type:String,required:!1},dayPeriod:{type:String,required:!1},numberingSystem:{type:String,required:!1},dateStyle:{type:String,required:!1},timeStyle:{type:String,required:!1},hourCycle:{type:String,required:!1},relative:{type:Boolean,required:!1},numeric:{type:String,required:!1},relativeStyle:{type:String,required:!1},title:{type:[Boolean,String],required:!1}},setup(n){const e=n,s=J()?.vnode.el,t=s?.getAttribute("datetime"),a=s?.getAttribute("data-locale"),c=L(),o=I(()=>{const d=e.datetime;return t&&c.isHydrating?new Date(t):e.datetime?new Date(d):new Date}),p=S(c.isHydrating&&window._nuxtTimeNow?new Date(window._nuxtTimeNow):new Date);if(e.relative){const f=setInterval(()=>{p.value=new Date},1e3);Y(()=>clearInterval(f))}const l=I(()=>{const{locale:d,relative:f,relativeStyle:_,...g}=e;return f?new Intl.RelativeTimeFormat(a??d,{...g,style:_}):new Intl.DateTimeFormat(a??d,g)}),x=I(()=>{if(!e.relative)return l.value.format(o.value);const d=(o.value.getTime()-p.value.getTime())/1e3,f=[{unit:"second",seconds:1,threshold:60},{unit:"minute",seconds:60,threshold:60},{unit:"hour",seconds:3600,threshold:24},{unit:"day",seconds:86400,threshold:30},{unit:"month",seconds:2592e3,threshold:12},{unit:"year",seconds:31536e3,threshold:1/0}],{unit:_,seconds:g}=f.find(({seconds:m,threshold:N})=>Math.abs(d/m)<N)||f[f.length-1],u=d/g;return l.value.format(Math.round(u),_)}),y=I(()=>o.value.toISOString()),b=I(()=>e.title===!0?y.value:typeof e.title=="string"?e.title:void 0),E={};return(d,f)=>(i(),w("time",j(E,{datetime:y.value,title:b.value}),C(x.value),17,ve))}},Se=v({__name:"Mix",props:{element:{}},setup(n){return(e,s)=>(i(!0),w(P,null,G(n.element.children,t=>(i(),h(O,{element:t},null,8,["element"]))),256))}}),be=Object.assign(Se,{__name:"AsideMinorNewsElementsMix"}),Ne=v({__name:"P",props:{element:{}},setup(n){return(e,s)=>(i(),w("p",null,[(i(!0),w(P,null,G(n.element.children,t=>(i(),h(O,{element:t},null,8,["element"]))),256))]))}}),Te=Object.assign(Ne,{__name:"AsideMinorNewsElementsP"}),ke=v({__name:"Text",props:{element:{}},setup(n){const e=n.element.data,s=e.match(/^(\s*)/)?.[1]?" ":"",t=e.match(/(\s*)$/)?.[1]?" ":"",a=F(e),c=s+a+t,o=K(Q,c);return(p,l)=>(i(),h(X(r(o))))}}),Ie=Object.assign(ke,{__name:"AsideMinorNewsElementsText"}),qe=v({__name:"Ref",props:{element:{}},setup(n){const{closePreview:e,setPreview:s}=ee(),t=n.element.storageValue,a={timeout:void 0,startTimeout(){this.timeout=setTimeout(()=>{this.reset()},400)},reset(){clearTimeout(this.timeout),this.timeout=void 0}};function c(){if(a.timeout){a.reset(),e();const o=t.type==="direct"?t.resolvedHref:se(t.resolvedHref.slice(1));return window.open(o,"_blank"),!1}return s(t.previewRequest),a.startTimeout(),!1}return(o,p)=>{const l=te;return i(),h(l,{onClickCapture:ne(c,["prevent"]),to:r(t).resolvedHref,style:{"--tGap":"1px","--xGap":"4px","--bGap":"4px"},class:"hocus:bg-(--linkColor)/15 relative -mx-[calc(var(--xGap)-3px)] -mt-(--tGap) -mb-(--bGap) rounded-sm bg-transparent px-(--xGap) pt-(--tGap) pb-(--bGap) text-(--linkColor) underline decoration-[color-mix(in_srgb,var(--linkColor)30%,transparent)] decoration-2 underline-offset-2 transition-[color,background]"},{default:A(()=>[ae(C(("formatText"in o?o.formatText:r(F))(n.element.data.label)),1)]),_:1},8,["to"])}}}),Me=Object.assign(qe,{__name:"AsideMinorNewsElementsRef"}),De=v({__name:"RenderNewsElement",props:{element:{}},setup(n){const e=(()=>{switch(n.element.schemaName){case ce.name:return Ie;case le.name:return Te;case ie.name:return Me;case oe.name:case re.name:return be;default:return K("span",{class:"text-red-500 font-semibold font-mono"},`<${n.element.schemaName} />`)}})();return(s,t)=>n.element?(i(),h(r(e),{key:0,element:n.element},null,8,["element"])):q("",!0)}}),O=Object.assign(De,{__name:"AsideMinorNewsRenderNewsElement"}),$e={class:"p-normal border-border border-b text-sm transition-[border]"},Ae=v({__name:"NewsItem",props:{item:{},isNew:{type:Boolean}},async setup(n){let e,s;const t=new Date(n.item.date),a=new Date,c=(()=>{const l=new Date(a);return l.setMonth(a.getMonth()-3),t>=l&&t<=a})(),o={year:"numeric",month:"long",day:"numeric"},p=t.toLocaleDateString(void 0,o);return[e,s]=B(()=>W(n.item.content.proseElement,async l=>{if(l.storageKey){const x=l.storageKey;n.item.content.storage[x]!==void 0&&(l.storageValue=n.item.content.storage[x])}})),await e,s(),(l,x)=>{const y=ue,b=ye;return i(),w("div",$e,[M("div",{class:me(["mb-small gap-small flex items-center transition-[color]",n.isNew?"font-semibold text-orange-700 dark:text-orange-300":"text-text-muted"])},[n.isNew?(i(),h(y,{key:0,name:"flame",class:"text-[1.2em]"})):q("",!0),D(b,j({datetime:r(t)},o,{relative:r(c),title:r(p),class:"cursor-help"}),null,16,["datetime","relative","title"])],2),M("div",{style:de({"--linkColor":n.isNew?"light-dark(var(--color-orange-700),var(--color-orange-300))":"var(--color-brand)"}),class:"gap-small flex flex-col text-[0.95em]"},[D(O,{element:n.item.content.proseElement},null,8,["element"])],4)])}}}),Ce=Object.assign(Ae,{__name:"AsideMinorNewsItem"}),Ee={class:"flex h-full w-full flex-col"},Re={key:0},Be={class:"text-text-muted p-normal text-center"},Pe=["disabled"],H="last-viewed-news-date",Ge=v({__name:"AsideMinorNews",async setup(n){let e,s;const t=S(0),a=S([]),c=S(new Set),o=S(),p=S(!1),l=L();function x(){return l.payload.data.news}function y(){l.payload.data.news={total:t.value||void 0,items:a.value,newIndices:Array.from(c.value),nextIndex:o.value}}function b(){return localStorage.getItem(H)}function E(u){localStorage.setItem(H,u)}async function d(u){p.value=!0;try{const m=await $fetch(`/api/news/batch/${u}`,{responseType:"json"});u===0&&(t.value=m.total,f(m.items)),a.value=a.value.concat(m.items),o.value=m.nextIndex,y()}catch(m){console.error("Error fetching news:",m)}finally{p.value=!1}}function f(u){if(u.length===0)return;const m=b(),N=u[0].date;if(m){const T=u.map((k,R)=>k.date>m?R:-1).filter(k=>k!==-1);T.length>0&&T.length<u.length&&(c.value=new Set(T))}E(N)}const _=x();_?(t.value=_.total||0,a.value=_.items,c.value=new Set(_.newIndices),o.value=_.nextIndex):([e,s]=B(()=>d(0)),await e,s());const g=([e,s]=B(()=>pe("news","no_news","show_more")),e=await e,s(),e);return(u,m)=>{const N=z,T=he,k=_e,R=fe,U=we;return i(),h(U,null,{default:A(()=>[M("div",Ee,[D(N,{icon:"bell",title:r(g).news,count:r(t)===0?void 0:r(t)},null,8,["title","count"]),r(a).length===0?(i(),w("section",Re,[M("p",Be,C(r(g).no_news),1)])):q("",!0),D(R,{class:"flex-1"},{default:A(()=>[(i(!0),w(P,null,G(r(a),(V,Z)=>(i(),h(Ce,{item:V,isNew:r(c).has(Z)},null,8,["item","isNew"]))),256)),D(k,null,{default:A(()=>[r(o)!==void 0?(i(),w("button",{key:0,onClick:m[0]||(m[0]=V=>d(r(o))),disabled:r(p),class:"my-big px-normal py-small bg-bg-accent hocus:border-text-disabled gap-normal m-auto flex w-auto cursor-pointer items-center rounded border-2 border-transparent text-sm transition-[border,background,color]"},[r(p)?(i(),h(T,{key:0,svg:"loadingSvg"in u?u.loadingSvg:r(ge)},null,8,["svg"])):q("",!0),M("span",null,C(r(g).show_more),1)],8,Pe)):q("",!0)]),_:1})]),_:1})])]),_:1})}}}),Le=Object.assign(Ge,{__name:"AsideMinorNews"});export{Le as default};
