import{_ as Q}from"./Dy6qNryr.js";import{bi as J,a8 as L,Z as S,a0 as X,O as o,Q as x,S as P,aY as H,ag as M,X as y,a2 as R,a3 as O,a1 as w,ae as U,aP as W,aR as ee,aQ as te,ac as r,Y as ne,ay as ae,$ as re,a6 as se,ad as F,aW as oe,U as $,V as ie,aT as le,aU as ce,bj as ue,bk as me,aS as de,a5 as I,a9 as B,R as A,al as pe,T as b,a4 as fe,ab as _e,bl as he,bm as we,av as ge,bn as xe}from"./DBNqVam1.js";import{_ as ye}from"./S79KmthL.js";const D={__JSPROSE_walkStop:!0},ve={};async function K(n,e){const s=await e(n);if(s===D)return D;if(s===ve)return;const a=n.children;if(a){for(const t of a.filter(Boolean))if(await K(t,e)===D)return D}}const Se=["datetime","title"],be={__name:"NuxtTime",props:{locale:{type:String,required:!1},datetime:{type:[String,Number,Date],required:!0},localeMatcher:{type:String,required:!1},weekday:{type:String,required:!1},era:{type:String,required:!1},year:{type:String,required:!1},month:{type:String,required:!1},day:{type:String,required:!1},hour:{type:String,required:!1},minute:{type:String,required:!1},second:{type:String,required:!1},timeZoneName:{type:String,required:!1},formatMatcher:{type:String,required:!1},hour12:{type:Boolean,required:!1,default:void 0},timeZone:{type:String,required:!1},calendar:{type:String,required:!1},dayPeriod:{type:String,required:!1},numberingSystem:{type:String,required:!1},dateStyle:{type:String,required:!1},timeStyle:{type:String,required:!1},hourCycle:{type:String,required:!1},relative:{type:Boolean,required:!1},numeric:{type:String,required:!1},relativeStyle:{type:String,required:!1},title:{type:[Boolean,String],required:!1}},setup(n){const e=n,s=J()?.vnode.el,a=s?.getAttribute("datetime"),t=s?.getAttribute("data-locale"),i=L(),l=M(()=>{const d=e.datetime;return a&&i.isHydrating?new Date(a):e.datetime?new Date(d):new Date}),c=S(i.isHydrating&&window._nuxtTimeNow?new Date(window._nuxtTimeNow):new Date);if(e.relative){const f=setInterval(()=>{c.value=new Date},1e3);X(()=>clearInterval(f))}const u=M(()=>{const{locale:d,relative:f,relativeStyle:h,...g}=e;return f?new Intl.RelativeTimeFormat(t??d,{...g,style:h}):new Intl.DateTimeFormat(t??d,g)}),_=M(()=>{if(!e.relative)return u.value.format(l.value);const d=(l.value.getTime()-c.value.getTime())/1e3,f=[{unit:"second",seconds:1,threshold:60},{unit:"minute",seconds:60,threshold:60},{unit:"hour",seconds:3600,threshold:24},{unit:"day",seconds:86400,threshold:30},{unit:"month",seconds:2592e3,threshold:12},{unit:"year",seconds:31536e3,threshold:1/0}],{unit:h,seconds:g}=f.find(({seconds:m,threshold:k})=>Math.abs(d/m)<k)||f[f.length-1],p=d/g;return u.value.format(Math.round(p),h)}),v=M(()=>l.value.toISOString()),N=M(()=>e.title===!0?v.value:typeof e.title=="string"?e.title:void 0),C={};return(d,f)=>(o(),x("time",H(C,{datetime:v.value,title:N.value}),P(_.value),17,Se))}},Ne=y({__name:"Mix",props:{element:{}},setup(n){return(e,s)=>(o(!0),x(R,null,O(n.element.children,a=>(o(),w(G,{element:a},null,8,["element"]))),256))}}),ke=Object.assign(Ne,{__name:"AsideMinorNewsElementsMix"}),Te=y({__name:"P",props:{element:{}},setup(n){return(e,s)=>(o(),x("p",null,[(o(!0),x(R,null,O(n.element.children,a=>(o(),w(G,{element:a},null,8,["element"]))),256))]))}}),qe=Object.assign(Te,{__name:"AsideMinorNewsElementsP"}),Me=y({__name:"Text",props:{element:{}},setup(n){const e=n.element.data,s=e.match(/^(\s*)/)?.[1]?" ":"",a=e.match(/(\s*)$/)?.[1]?" ":"",t=U(e),i=s+t+a,l=W(ee,i);return(c,u)=>(o(),w(te(r(l))))}}),Ie=Object.assign(Me,{__name:"AsideMinorNewsElementsText"}),De=y({__name:"Ref",props:{element:{}},setup(n){const e=ne(),{closePreview:s,setPreview:a}=ae(),t=n.element.storageValue,i={timeout:void 0,startTimeout(){this.timeout=setTimeout(()=>{this.reset()},400)},reset(){clearTimeout(this.timeout),this.timeout=void 0}};function l(){if(i.timeout&&t.type!=="error"){i.reset(),s();const c=t.type==="external"?t.resolvedHref:e(t.resolvedHref.slice(1));return window.open(c,"_blank"),!1}return t.type==="error"||(a(t.previewRequest),i.startTimeout()),!1}return re(()=>{t.type==="error"&&console.warn(`Error in link element inside new item: ${t.error}`)}),(c,u)=>{const _=se;return o(),w(_,{onClickCapture:oe(l,["prevent"]),to:r(t).type==="error"?void 0:r(t).resolvedHref,style:{"--tGap":"1px","--xGap":"4px","--bGap":"4px"},class:F([`relative -mx-[calc(var(--xGap)-3px)] -mt-(--tGap) -mb-(--bGap) rounded-sm
      bg-transparent px-(--xGap) pt-(--tGap) pb-(--bGap) underline decoration-2
      underline-offset-2 transition-[background]`,r(t).type==="error"?`hocus:bg-red-400/20 cursor-not-allowed text-red-600
          decoration-red-400/40 dark:text-red-400`:`hocus:bg-(--linkColor)/15 text-(--linkColor)
          decoration-[color-mix(in_srgb,var(--linkColor)30%,transparent)]`])},{default:$(()=>[ie(P(("formatText"in c?c.formatText:r(U))(n.element.data.label)),1)]),_:1},8,["to","class"])}}}),$e=Object.assign(De,{__name:"AsideMinorNewsElementsRef"}),Ae=y({__name:"RenderNewsElement",props:{element:{}},setup(n){const e=(()=>{switch(n.element.schemaName){case de.name:return Ie;case me.name:return qe;case ue.name:return $e;case ce.name:case le.name:return ke;default:return W("span",{class:"text-red-500 font-semibold font-mono"},`<${n.element.schemaName} />`)}})();return(s,a)=>n.element?(o(),w(r(e),{key:0,element:n.element},null,8,["element"])):I("",!0)}}),G=Object.assign(Ae,{__name:"AsideMinorNewsRenderNewsElement"}),Ce={class:"p-normal border-border border-b text-sm"},Ee=y({__name:"NewsItem",props:{item:{},isNew:{type:Boolean}},async setup(n){let e,s;const a=new Date(n.item.date),t=new Date,i=(()=>{const u=new Date(t);return u.setMonth(t.getMonth()-3),a>=u&&a<=t})(),l={year:"numeric",month:"long",day:"numeric"},c=a.toLocaleDateString(void 0,l);return[e,s]=B(()=>K(n.item.content.proseElement,async u=>{if(u.storageKey){const _=u.storageKey;n.item.content.storage[_]!==void 0&&(u.storageValue=n.item.content.storage[_])}})),await e,s(),(u,_)=>{const v=pe,N=be;return o(),x("div",Ce,[A("div",{class:F(["mb-small gap-small flex items-center",n.isNew?"font-semibold text-orange-700 dark:text-orange-300":"text-text-muted"])},[n.isNew?(o(),w(v,{key:0,name:"flame",class:"text-[1.2em]"})):I("",!0),b(N,H({datetime:r(a)},l,{relative:r(i),title:r(c),class:"cursor-help"}),null,16,["datetime","relative","title"])],2),A("div",{style:fe({"--linkColor":n.isNew?"light-dark(var(--color-orange-700),var(--color-orange-300))":"var(--color-brand)"}),class:"gap-small flex flex-col text-[0.95em]"},[b(G,{element:n.item.content.proseElement},null,8,["element"])],4)])}}}),Be=Object.assign(Ee,{__name:"AsideMinorNewsItem"}),Pe={class:"flex h-full w-full flex-col"},Re={key:0},Oe=["disabled"],j="last-viewed-news-date",Ge=y({__name:"AsideMinorNews",async setup(n){let e,s;const a=S(0),t=S([]),i=S(new Set),l=S(),c=S(!1),u=L();function _(){return u.payload.data.news}function v(){u.payload.data.news={total:a.value||void 0,items:t.value,newIndices:Array.from(i.value),nextIndex:l.value}}function N(){return localStorage.getItem(j)}function C(p){localStorage.setItem(j,p)}async function d(p){c.value=!0;try{const m=await $fetch(`/api/news/batch/${p}`,{responseType:"json"});p===0&&(a.value=m.total,f(m.items)),t.value=t.value.concat(m.items),l.value=m.nextIndex,v()}catch(m){console.error("Error fetching news:",m)}finally{c.value=!1}}function f(p){if(p.length===0)return;const m=N(),k=p[0].date;if(m){const T=p.map((q,E)=>q.date>m?E:-1).filter(q=>q!==-1);T.length>0&&T.length<p.length&&(i.value=new Set(T))}C(k)}const h=_();h?(a.value=h.total||0,t.value=h.items,i.value=new Set(h.newIndices),l.value=h.nextIndex):([e,s]=B(()=>d(0)),await e,s());const g=([e,s]=B(()=>_e("news","no_news","show_more")),e=await e,s(),e);return(p,m)=>{const k=Q,T=he,q=xe,E=ge,Y=we,Z=ye;return o(),w(Z,null,{default:$(()=>[A("div",Pe,[b(k,{icon:"bell",title:r(g).news,count:r(a)===0?void 0:r(a)},null,8,["title","count"]),r(t).length===0?(o(),x("section",Re,[b(T,{text:r(g).no_news},null,8,["text"])])):I("",!0),b(Y,{class:"flex-1"},{default:$(()=>[(o(!0),x(R,null,O(r(t),(V,z)=>(o(),w(Be,{item:V,isNew:r(i).has(z)},null,8,["item","isNew"]))),256)),b(E,null,{default:$(()=>[r(l)!==void 0?(o(),x("button",{key:0,onClick:m[0]||(m[0]=V=>d(r(l))),disabled:r(c),class:"my-big px-normal py-small bg-bg-accent hocus:border-text-disabled gap-normal m-auto flex w-auto cursor-pointer items-center rounded border-2 border-transparent text-sm transition-[border]"},[r(c)?(o(),w(q,{key:0})):I("",!0),A("span",null,P(r(g).show_more),1)],8,Oe)):I("",!0)]),_:1})]),_:1})])]),_:1})}}}),He=Object.assign(Ge,{__name:"AsideMinorNews"});export{He as default};
