import{_ as Q}from"./C7lup6U2.js";import{be as Y,a8 as L,Z as S,a0 as J,O as o,Q as x,S as P,aV as H,ag as M,X as y,a2 as O,a3 as R,a1 as w,ae as U,aL as F,aN as X,aM as ee,ac as r,Y as te,aH as ne,a6 as ae,aT as se,U as A,V as re,aP as oe,aQ as ie,bf as le,bg as ce,aO as ue,a5 as I,a9 as B,R as C,al as me,T as b,ad as de,a4 as fe,ab as pe,bh as _e,bi as he,aw as we,bj as ge}from"./DtnvSbKK.js";import{_ as xe}from"./nt4HtuvQ.js";const D={__JSPROSE_walkStop:!0},ye={};async function K(t,e){const s=await e(t);if(s===D)return D;if(s===ye)return;const n=t.children;if(n){for(const a of n.filter(Boolean))if(await K(a,e)===D)return D}}const ve=["datetime","title"],Se={__name:"NuxtTime",props:{locale:{type:String,required:!1},datetime:{type:[String,Number,Date],required:!0},localeMatcher:{type:String,required:!1},weekday:{type:String,required:!1},era:{type:String,required:!1},year:{type:String,required:!1},month:{type:String,required:!1},day:{type:String,required:!1},hour:{type:String,required:!1},minute:{type:String,required:!1},second:{type:String,required:!1},timeZoneName:{type:String,required:!1},formatMatcher:{type:String,required:!1},hour12:{type:Boolean,required:!1,default:void 0},timeZone:{type:String,required:!1},calendar:{type:String,required:!1},dayPeriod:{type:String,required:!1},numberingSystem:{type:String,required:!1},dateStyle:{type:String,required:!1},timeStyle:{type:String,required:!1},hourCycle:{type:String,required:!1},relative:{type:Boolean,required:!1},numeric:{type:String,required:!1},relativeStyle:{type:String,required:!1},title:{type:[Boolean,String],required:!1}},setup(t){const e=t,s=Y()?.vnode.el,n=s?.getAttribute("datetime"),a=s?.getAttribute("data-locale"),i=L(),l=M(()=>{const d=e.datetime;return n&&i.isHydrating?new Date(n):e.datetime?new Date(d):new Date}),c=S(i.isHydrating&&window._nuxtTimeNow?new Date(window._nuxtTimeNow):new Date);if(e.relative){const p=setInterval(()=>{c.value=new Date},1e3);J(()=>clearInterval(p))}const u=M(()=>{const{locale:d,relative:p,relativeStyle:h,...g}=e;return p?new Intl.RelativeTimeFormat(a??d,{...g,style:h}):new Intl.DateTimeFormat(a??d,g)}),_=M(()=>{if(!e.relative)return u.value.format(l.value);const d=(l.value.getTime()-c.value.getTime())/1e3,p=[{unit:"second",seconds:1,threshold:60},{unit:"minute",seconds:60,threshold:60},{unit:"hour",seconds:3600,threshold:24},{unit:"day",seconds:86400,threshold:30},{unit:"month",seconds:2592e3,threshold:12},{unit:"year",seconds:31536e3,threshold:1/0}],{unit:h,seconds:g}=p.find(({seconds:m,threshold:T})=>Math.abs(d/m)<T)||p[p.length-1],f=d/g;return u.value.format(Math.round(f),h)}),v=M(()=>l.value.toISOString()),N=M(()=>e.title===!0?v.value:typeof e.title=="string"?e.title:void 0),$={};return(d,p)=>(o(),x("time",H($,{datetime:v.value,title:N.value}),P(_.value),17,ve))}},be=y({__name:"Mix",props:{element:{}},setup(t){return(e,s)=>(o(!0),x(O,null,R(t.element.children,n=>(o(),w(V,{element:n},null,8,["element"]))),256))}}),Ne=Object.assign(be,{__name:"AsideMinorNewsElementsMix"}),Te=y({__name:"P",props:{element:{}},setup(t){return(e,s)=>(o(),x("p",null,[(o(!0),x(O,null,R(t.element.children,n=>(o(),w(V,{element:n},null,8,["element"]))),256))]))}}),ke=Object.assign(Te,{__name:"AsideMinorNewsElementsP"}),qe=y({__name:"Text",props:{element:{}},setup(t){const e=t.element.data,s=e.match(/^(\s*)/)?.[1]?" ":"",n=e.match(/(\s*)$/)?.[1]?" ":"",a=U(e),i=s+a+n,l=F(X,i);return(c,u)=>(o(),w(ee(r(l))))}}),Me=Object.assign(qe,{__name:"AsideMinorNewsElementsText"}),Ie=y({__name:"Ref",props:{element:{}},setup(t){const e=te(),{closePreview:s,setPreview:n}=ne(),a=t.element.storageValue,i={timeout:void 0,startTimeout(){this.timeout=setTimeout(()=>{this.reset()},400)},reset(){clearTimeout(this.timeout),this.timeout=void 0}};function l(){if(i.timeout){i.reset(),s();const c=a.type==="direct"?a.resolvedHref:e(a.resolvedHref.slice(1));return window.open(c,"_blank"),!1}return n(a.previewRequest),i.startTimeout(),!1}return(c,u)=>{const _=ae;return o(),w(_,{onClickCapture:se(l,["prevent"]),to:r(a).resolvedHref,style:{"--tGap":"1px","--xGap":"4px","--bGap":"4px"},class:"hocus:bg-(--linkColor)/15 relative -mx-[calc(var(--xGap)-3px)] -mt-(--tGap) -mb-(--bGap) rounded-sm bg-transparent px-(--xGap) pt-(--tGap) pb-(--bGap) text-(--linkColor) underline decoration-[color-mix(in_srgb,var(--linkColor)30%,transparent)] decoration-2 underline-offset-2 transition-[background]"},{default:A(()=>[re(P(("formatText"in c?c.formatText:r(U))(t.element.data.label)),1)]),_:1},8,["to"])}}}),De=Object.assign(Ie,{__name:"AsideMinorNewsElementsRef"}),Ae=y({__name:"RenderNewsElement",props:{element:{}},setup(t){const e=(()=>{switch(t.element.schemaName){case ue.name:return Me;case ce.name:return ke;case le.name:return De;case ie.name:case oe.name:return Ne;default:return F("span",{class:"text-red-500 font-semibold font-mono"},`<${t.element.schemaName} />`)}})();return(s,n)=>t.element?(o(),w(r(e),{key:0,element:t.element},null,8,["element"])):I("",!0)}}),V=Object.assign(Ae,{__name:"AsideMinorNewsRenderNewsElement"}),Ce={class:"p-normal border-border border-b text-sm"},$e=y({__name:"NewsItem",props:{item:{},isNew:{type:Boolean}},async setup(t){let e,s;const n=new Date(t.item.date),a=new Date,i=(()=>{const u=new Date(a);return u.setMonth(a.getMonth()-3),n>=u&&n<=a})(),l={year:"numeric",month:"long",day:"numeric"},c=n.toLocaleDateString(void 0,l);return[e,s]=B(()=>K(t.item.content.proseElement,async u=>{if(u.storageKey){const _=u.storageKey;t.item.content.storage[_]!==void 0&&(u.storageValue=t.item.content.storage[_])}})),await e,s(),(u,_)=>{const v=me,N=Se;return o(),x("div",Ce,[C("div",{class:de(["mb-small gap-small flex items-center",t.isNew?"font-semibold text-orange-700 dark:text-orange-300":"text-text-muted"])},[t.isNew?(o(),w(v,{key:0,name:"flame",class:"text-[1.2em]"})):I("",!0),b(N,H({datetime:r(n)},l,{relative:r(i),title:r(c),class:"cursor-help"}),null,16,["datetime","relative","title"])],2),C("div",{style:fe({"--linkColor":t.isNew?"light-dark(var(--color-orange-700),var(--color-orange-300))":"var(--color-brand)"}),class:"gap-small flex flex-col text-[0.95em]"},[b(V,{element:t.item.content.proseElement},null,8,["element"])],4)])}}}),Ee=Object.assign($e,{__name:"AsideMinorNewsItem"}),Be={class:"flex h-full w-full flex-col"},Pe={key:0},Oe=["disabled"],j="last-viewed-news-date",Re=y({__name:"AsideMinorNews",async setup(t){let e,s;const n=S(0),a=S([]),i=S(new Set),l=S(),c=S(!1),u=L();function _(){return u.payload.data.news}function v(){u.payload.data.news={total:n.value||void 0,items:a.value,newIndices:Array.from(i.value),nextIndex:l.value}}function N(){return localStorage.getItem(j)}function $(f){localStorage.setItem(j,f)}async function d(f){c.value=!0;try{const m=await $fetch(`/api/news/batch/${f}`,{responseType:"json"});f===0&&(n.value=m.total,p(m.items)),a.value=a.value.concat(m.items),l.value=m.nextIndex,v()}catch(m){console.error("Error fetching news:",m)}finally{c.value=!1}}function p(f){if(f.length===0)return;const m=N(),T=f[0].date;if(m){const k=f.map((q,E)=>q.date>m?E:-1).filter(q=>q!==-1);k.length>0&&k.length<f.length&&(i.value=new Set(k))}$(T)}const h=_();h?(n.value=h.total||0,a.value=h.items,i.value=new Set(h.newIndices),l.value=h.nextIndex):([e,s]=B(()=>d(0)),await e,s());const g=([e,s]=B(()=>pe("news","no_news","show_more")),e=await e,s(),e);return(f,m)=>{const T=Q,k=_e,q=ge,E=we,W=he,Z=xe;return o(),w(Z,null,{default:A(()=>[C("div",Be,[b(T,{icon:"bell",title:r(g).news,count:r(n)===0?void 0:r(n)},null,8,["title","count"]),r(a).length===0?(o(),x("section",Pe,[b(k,{text:r(g).no_news},null,8,["text"])])):I("",!0),b(W,{class:"flex-1"},{default:A(()=>[(o(!0),x(O,null,R(r(a),(G,z)=>(o(),w(Ee,{item:G,isNew:r(i).has(z)},null,8,["item","isNew"]))),256)),b(E,null,{default:A(()=>[r(l)!==void 0?(o(),x("button",{key:0,onClick:m[0]||(m[0]=G=>d(r(l))),disabled:r(c),class:"my-big px-normal py-small bg-bg-accent hocus:border-text-disabled gap-normal m-auto flex w-auto cursor-pointer items-center rounded border-2 border-transparent text-sm transition-[border]"},[r(c)?(o(),w(q,{key:0})):I("",!0),C("span",null,P(r(g).show_more),1)],8,Oe)):I("",!0)]),_:1})]),_:1})])]),_:1})}}}),Le=Object.assign(Re,{__name:"AsideMinorNews"});export{Le as default};
