import{T as F,a$ as _e,aW as ae,b0 as U,i as O,b1 as ie,b2 as we,b3 as xe,b4 as ye,b5 as Se,a_ as Ce,b6 as Me,b7 as $e,_ as Ie,N as l,O as k,P as S,am as ue,W as N,aA as de,a1 as P,Q as W,ac as f,R as V,ad as R,a0 as x,aB as X,S as I,a2 as H,a4 as T,Y as $,a8 as z,aY as C,b8 as ne,au as G,aw as Ae,aX as me,b9 as J,ba as pe,ag as D,bb as Pe,bc as Ee,bd as Te,be as he,a3 as se,at as Y,Z as De,aT as He,bf as Ne,bg as oe,j as re,g as le,h as ce}from"./Du3Wvoik.js";import{u as L}from"./BL9_poU1.js";import{a as Re,f as Ve}from"./B3LqoS7A.js";import{u as qe}from"./CDUyxJFM.js";import{D as Z}from"./DidrgFjr.js";import{_ as j}from"./DV0FzFYP.js";import{p as ee}from"./DtJVcRLM.js";import{u as fe}from"./tKM8BPJ_.js";import{s as Be}from"./D5fLQY3u.js";/* empty css        */import{a as Ze}from"./BokzypnP.js";import{w as We,i as ze}from"./DKpbjkX5.js";const Le=({rawElement:e,takenIds:t,slugify:a})=>{let n="";const p=e.uniqueName||e.slug;if(p?n=a?a(p):p:n=e.schema.name+"-"+e.hash.substring(0,9),t)if(e.uniqueName){if(t.has(n)){const d=t.get(n);t.delete(n);const c=d.schema.name+"-"+d.id;let s=c,_=1;for(;t.has(s);)s=`${c}-${_++}`;d.id=s,t.set(s,d)}}else{let d=n,c=1;for(;t.has(d);)d=`${n}-${c++}`;n=d}return n};async function Fe(e){const{rawProse:t,pre:a,post:n,step:p,slugify:d}=e,c=e.idMaker||Le,s=new Map(e.takenIds),_={},w=await We(t,async(o,i)=>{a&&await a(o);const h=_e({schema:o.schema});if(o.data&&(h.data=o.data),o.storageKey&&(h.storageKey=o.storageKey),i&&i.length>0&&(h.children=i),o.schema.linkable){const u=c({rawElement:o,takenIds:s,slugify:d});if(!u.trim())throw new F(`Empty ID generated from "${o.schema.name}" element!
This might happen because of wrongly configured "idMaker" or obscure element data that was passed to create an ID!`);if(s.has(u))throw new F(`Element ID collision: "${u}" is already taken!
Make sure "idMaker" you are using generates non-repeating IDs!`);if(h.id=u,s.set(u,h),o.uniqueName){if(_[o.uniqueName])throw new F(`Duplicate uniqueName: "${o.uniqueName}" is already used by another element!
If you are using document prose, make sure not to directly insert imported or manually created external uniques as their names might intersect with document-level uniques names!`);_[o.uniqueName]=h}}return n&&await n(h),p&&await p({rawElement:o,proseElement:h}),h});if(ze(w))throw new F("Raw to Prose walk cannot be manually stopped!");return{prose:w,takenIds:s,uniques:_}}const Ge=async e=>{const t={en:async()=>await ae(()=>import("./BYSfzAfb.js"),[],import.meta.url),ru:async()=>await ae(()=>import("./zTTgIRis.js"),[],import.meta.url)},a=e.language&&e.language in t?await t[e.language]():void 0;return a?a.default:n=>n},Oe=U(({result:e})=>({step:({rawElement:t})=>{if(O(t,ie)||O(t,we)){const a=t.storageKey?.replace("problemScript:","");a&&e.problemScripts.add(a)}}})),Ue=U(({result:e})=>({step:({rawElement:t})=>{if(!t.storageKey)return;const a=[{schema:xe,key:"Dep"},{schema:ye,key:"Dependency"},{schema:Se,key:"Ref"},{schema:Ce,key:"Reference"}];let n;for(const{schema:d,key:c}of a)if(O(t,d)){n={storageKey:t.storageKey,label:t.data.label.trim(),type:c};break}if(!n)return;const p=e.contentLinks.get(n.storageKey)||[];e.contentLinks.set(n.storageKey,[...p,n])}})),je="__ERUDIT_included";function Ke(e){return e[je]===!0}const Ye=U(({result:e})=>({step({rawElement:t}){if(Ke(t))return;const a=t.schema.name;e.schemaCounts[a]=(e.schemaCounts[a]||0)+1}})),Qe=U(({result:e})=>({step({rawElement:t}){if(t.uniqueName){const a=t.title||t.snippet?.title;a&&(e.uniqueTitles[t.uniqueName]=a)}}}));async function Xe(e){const{rawProse:t,hooks:a,schemaHooks:n}=e,p={prose:void 0,uniques:{},takenIds:new Map,toc:[],snippets:[],files:new Set,problemScripts:new Set,contentLinks:new Map,schemaCounts:{},uniqueTitles:{}},d=[Me,$e,Oe,Ue,Ye,Qe,...a||[]],c=[];for(const o of d){const i=await o({task:e,result:p});i&&c.push(i)}const s=new Map;for(const[o,i]of n||[]){const h=await i({task:e,result:p});h&&s.set(o,h)}const w=await Fe({rawProse:t,step:async o=>{for(const[i,h]of s)h.anyStep&&await h.anyStep(o),O(o.rawElement,i)&&h.matchStep&&await h.matchStep({rawElement:o.rawElement,proseElement:o.proseElement});for(const i of c)i.step&&await i.step(o)},idMaker:e.idMaker,slugify:e.createSlugify?await e.createSlugify(e):await Ge(e)});p.prose=w.prose,p.uniques=w.uniques,p.takenIds=w.takenIds;for(const o of s.values())o.finally&&await o.finally();for(const o of c)o.finally&&await o.finally();return p}async function K(){const{appElements:e,languageCode:t}=L();return await e[ie.name].languages[t]()}const Je=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">\r
  <path d="M8.86,13.75l5.75-5.75-1.14-1.14-4.61,4.61-2.32-2.32-1.14,1.14,3.47,3.47ZM10,18.15c-1.13,0-2.19-.21-3.18-.64-.99-.43-1.86-1.01-2.59-1.74-.73-.73-1.31-1.6-1.74-2.59-.43-.99-.64-2.05-.64-3.18,0-1.13.21-2.19.64-3.18s1.01-1.86,1.74-2.59c.73-.73,1.6-1.31,2.59-1.74s2.05-.64,3.18-.64c1.13,0,2.19.21,3.18.64.99.43,1.86,1.01,2.59,1.74.73.73,1.31,1.6,1.74,2.59.43.99.64,2.05.64,3.18s-.22,2.19-.64,3.18c-.43.99-1.01,1.86-1.74,2.59s-1.6,1.31-2.59,1.74c-.99.43-2.05.64-3.18.64M10,16.52c1.82,0,3.36-.63,4.63-1.9s1.9-2.81,1.9-4.63-.63-3.36-1.9-4.63c-1.26-1.26-2.81-1.9-4.63-1.9-1.82,0-3.36.63-4.63,1.9s-1.9,2.81-1.9,4.63c0,1.82.63,3.36,1.9,4.63,1.26,1.26,2.81,1.9,4.63,1.9"/>\r
</svg>`,ve=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">\r
  <path d="M28.58,6.4l-7.8,20.14c-.26.67-1.01,1-1.68.74-.16-.06-.3-.15-.43-.27l-4.39-4.21-2.7,2.7c-.26.26-.66.26-.92,0-.12-.12-.19-.29-.19-.46v-5.87l-6.74-6.46c-.52-.5-.54-1.32-.04-1.84.17-.18.38-.3.62-.36l22.74-5.84c.7-.18,1.4.24,1.58.94.06.26.05.54-.05.79h0ZM25.42,7.88l-14.25,9.29,2.26,2.16,12-11.45h0Z"/>\r
</svg>`,be=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">\r
  <path d="M2,2v1.5h2.1l-.37.3c-.6.6-1.02,1.25-1.27,1.95-.3.7-.45,1.42-.45,2.17,0,1.4.42,2.65,1.27,3.75.8,1.05,1.87,1.77,3.22,2.17v-1.57c-.9-.35-1.62-.92-2.17-1.72-.55-.75-.82-1.62-.82-2.62,0-.55.1-1.07.3-1.57.2-.55.55-1.05,1.05-1.5l.15-.15v1.8h1.5V2H2ZM9.5,2.23v1.57c.9.3,1.62.85,2.17,1.65.55.75.82,1.62.82,2.62,0,.55-.1,1.07-.3,1.57-.25.55-.57,1.05-.97,1.5l-.22.15v-1.8h-1.5v4.5h4.5v-1.5h-2.02l.22-.22c.65-.65,1.1-1.32,1.35-2.02.3-.75.45-1.47.45-2.17,0-1.4-.42-2.65-1.27-3.75-.8-1.1-1.87-1.82-3.22-2.17v.07Z"/>\r
</svg>`,et=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22">\r
  <path d="M11,6.36c2.56,0,4.64,2.08,4.64,4.64,0,1.72-.93,3.21-2.32,4.02v1.39c0,.43-.35.77-.77.77h-3.09c-.43,0-.77-.35-.77-.77v-1.39c-1.38-.8-2.32-2.3-2.32-4.02,0-2.56,2.08-4.64,4.64-4.64M12.55,17.95v.77c0,.43-.35.77-.77.77h-1.55c-.43,0-.77-.35-.77-.77v-.77h3.09ZM17.18,10.23h2.32v1.55h-2.32v-1.55ZM2.5,10.23h2.32v1.55h-2.32v-1.55ZM11.77,2.5v2.32h-1.55v-2.32h1.55ZM5.53,4.43l1.65,1.65-1.1,1.09-1.65-1.64,1.1-1.1ZM14.83,6.08l1.64-1.65,1.11,1.1-1.65,1.64-1.1-1.1Z"/>\r
</svg>`,tt=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16.97 16.97">\r
  <path d="M10.41,4.64c0-.31.2-.57.43-.79.21-.2.34-.45.34-.72,0-.63-.69-1.15-1.53-1.15s-1.53.51-1.53,1.15c0,.28.13.53.35.73.22.2.42.46.42.76,0,.41-.33.74-.74.75-.02,0-.03,0-.05,0-.77-.05-1.54-.13-2.31-.23-.31-.04-.6.17-.65.49,0,.05,0,.11,0,.16.11.76.19,1.53.23,2.31.02.41-.29.76-.7.78-.02,0-.03,0-.05,0-.3,0-.56-.19-.76-.42-.2-.22-.45-.35-.73-.35-.63,0-1.15.69-1.15,1.53s.51,1.53,1.15,1.53c.27,0,.52-.13.72-.34.21-.23.48-.43.79-.43.42,0,.77.34.77.76,0,.01,0,.02,0,.03-.04.96-.12,1.91-.24,2.86-.04.31.18.6.49.64.8.11,1.62.19,2.44.24.41.02.76-.29.78-.7,0-.02,0-.03,0-.05,0-.3-.19-.56-.42-.76-.22-.2-.35-.45-.35-.73,0-.63.69-1.15,1.53-1.15s1.53.51,1.53,1.15c0,.27-.13.52-.34.72-.23.21-.43.48-.43.79,0,.42.34.77.76.77,0,0,.02,0,.03,0,1.02-.04,2.04-.12,3.03-.26.26-.03.46-.24.49-.49.13-1,.22-2.01.26-3.03.01-.42-.32-.78-.74-.79,0,0-.02,0-.03,0-.31,0-.57.2-.79.43-.2.21-.45.34-.72.34-.63,0-1.15-.69-1.15-1.53s.51-1.53,1.15-1.53c.28,0,.53.13.73.35.2.22.46.42.76.42.41,0,.75-.33.75-.74,0-.02,0-.03,0-.05-.05-.82-.13-1.63-.24-2.44-.04-.31-.33-.53-.64-.49-.94.13-1.89.21-2.86.24-.42.01-.77-.32-.79-.74,0-.01,0-.02,0-.03"/>\r
</svg>`,at=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 560">\r
  <path d="M119.1,480c-8.15,0-14.95-2.75-20.41-8.26-5.51-5.45-8.26-12.25-8.26-20.41s2.75-14.9,8.26-20.41c5.45-5.45,12.25-8.18,20.41-8.18h229.09c8.15,0,14.95,2.73,20.41,8.18s8.26,12.31,8.26,20.41c0,8.15-2.75,14.95-8.26,20.41-5.45,5.51-12.25,8.26-20.41,8.26H119.1ZM119.1,365.42c-8.1,0-14.9-2.75-20.41-8.26-5.45-5.45-8.18-12.25-8.18-20.41s2.73-14.9,8.18-20.41c5.51-5.45,12.31-8.18,20.41-8.18h401c8.15,0,14.95,2.73,20.41,8.18,5.51,5.51,8.26,12.31,8.26,20.41s-2.75,14.95-8.26,20.41c-5.45,5.51-12.25,8.26-20.41,8.26H119.1ZM119.1,250.83c-8.1,0-14.9-2.73-20.41-8.18-5.45-5.51-8.18-12.31-8.18-20.41s2.73-14.95,8.18-20.41c5.51-5.51,12.31-8.26,20.41-8.26h401c8.15,0,14.95,2.75,20.41,8.26,5.51,5.45,8.26,12.25,8.26,20.41s-2.75,14.9-8.26,20.41c-5.45,5.45-12.25,8.18-20.41,8.18H119.1ZM119.1,136.25c-8.1,0-14.9-2.73-20.41-8.18-5.45-5.51-8.18-12.31-8.18-20.41s2.73-14.95,8.18-20.41c5.51-5.51,12.31-8.26,20.41-8.26h401c8.15,0,14.95,2.75,20.41,8.26,5.51,5.45,8.26,12.25,8.26,20.41s-2.75,14.9-8.26,20.41c-5.45,5.45-12.25,8.18-20.41,8.18H119.1Z"/>\r
</svg>`;async function nt(e,t){if(!e||!t)return;const n=(await import(e)).default;return n(t)}const st={},ot={class:"border-border border-t"};function rt(e,t){return l(),k("div",null,[S("div",ot,[ue(e.$slots,"default")])])}const te=Ie(st,[["render",rt]]),lt={class:"flex-1"},ct={class:"group-hocus:bg-border/80 text-text-muted shrink-0 rounded bg-transparent p-0.5 transition-[background]"},it={key:0,class:"border-border border-t border-dashed py-(--proseAsideWidth)"},ge=N({__name:"ProblemExpanderSection",props:{title:{},element:{}},setup(e){const t=fe(),{EruditIcon:a}=L(),n=$(!1),p=Re(e.element);return de(()=>{p.value&&(n.value=!0)}),(d,c)=>(l(),k(P,null,[S("div",{onClick:c[0]||(c[0]=s=>n.value=!n.value),class:"group border-border text-text-muted relative flex cursor-pointer items-center border-t p-(--proseAsideWidth) font-semibold first:border-t-0"},[S("div",lt,W(f(t)(e.title)),1),S("button",ct,[V(f(a),{name:f(ee),class:R(["micro:text-[26px] text-[22px] transition-[rotate]",n.value?"rotate-45":""])},null,8,["name","class"])])]),(l(),x(X,null,{default:I(()=>[n.value?(l(),k("div",it,[(l(!0),k(P,null,H(e.element.children,s=>(l(),x(j,{element:s},null,8,["element"]))),256))])):T("",!0)]),_:1}))],64))}}),ut={key:0,class:"py-(--proseAsideWidth)"},dt=N({__name:"Hint",props:{value:{}},async setup(e){let t,a;const n=([t,a]=z(()=>K()),t=await t,a(),t);return(p,d)=>(l(),x(te,null,{default:I(()=>[e.value.length===1?(l(),k("div",ut,[(l(!0),k(P,null,H(e.value[0].children,c=>(l(),x(j,{element:c},null,8,["element"]))),256))])):(l(!0),k(P,{key:1},H(e.value,(c,s)=>(l(),x(ge,{title:f(n).action_hint+" "+(s+1),element:c},null,8,["title","element"]))),256))]),_:1}))}}),mt={key:0,class:"py-(--proseAsideWidth)"},Q=N({__name:"DefaultPlusSections",props:{value:{}},setup(e){const t=e.value.children.filter(n=>!C(n,ne)),a=e.value.children.filter(n=>C(n,ne));return(n,p)=>(l(),x(te,null,{default:I(()=>[f(t).length?(l(),k("div",mt,[(l(!0),k(P,null,H(f(t),d=>(l(),x(j,{element:d},null,8,["element"]))),256))])):T("",!0),f(a).length?(l(!0),k(P,{key:1},H(f(a),d=>(l(),x(ge,{title:d.data,element:d},null,8,["title","element"]))),256)):T("",!0)]),_:1}))}}),ke=N({__name:"ProblemButton",props:{active:{type:Boolean}},setup(e){return(t,a)=>(l(),k("button",{class:R([`bg-bg-main border-border/80 text-main-xs micro:px-2.5 min-w-[30px]
      cursor-pointer rounded border px-1.5 py-[5px] font-semibold shadow
      shadow-[light-dark(#d9d9d9,#3c3c3c)]
      transition-[color,background,border,box-shadow]`,{"border-brand/50 bg-brand/10 text-brand":e.active,"text-text-muted hocus:text-brand hocus:border-brand/50":!e.active}])},[ue(t.$slots,"default")],2))}}),pt={class:"gap-small flex w-full flex-col"},ht=["placeholder"],ft={class:"text-text-dimmed text-main-xs italic"},vt=N({__name:"Check",props:{check:{},script:{}},emits:["status-change"],async setup(e,{emit:t}){let a,n;const p=D(()=>Ee(e.check.data.serializedValidator)),d=t,c={default:{icon:ve,labelClass:"text-text-muted",inputClass:"border-border text-text",buttonClass:"text-text-muted border-border hocus:border-text-muted hocus:text-text"},correct:{icon:Be,labelClass:"text-lime-600",inputClass:"text-lime-600 border-lime-500",buttonClass:"text-lime-600 border-lime-500"},wrong:{icon:ee,iconClass:"rotate-45",labelClass:"text-red-700 dark:text-red-400",inputClass:"text-red-700 dark:text-red-400 border-red-400",buttonClass:"text-red-700 dark:text-red-400 border-red-400"}},s=$("default"),_=fe(),{EruditIcon:w,EruditTransition:o}=L(),i=([a,n]=z(()=>K()),a=await a,n(),a),h=D(()=>{if(e.check.data.hint)return e.check.data.hint;if(e.check.data.serializedValidator.type==="boolean")return i.boolean_check_hint;if(e.check.data.serializedValidator.type==="array")return i.array_check_hint(e.check.data.serializedValidator.ordered,e.check.data.serializedValidator.separator)}),u=D(()=>{const r=_(e.check.data.label??i.action_answer).trimEnd();return r?/[\p{L}\p{N}]$/u.test(r)?`${r}:`:r:""}),b=G("answer"),m=$(""),g=$(null);Ae(m,()=>{s.value="default",g.value=null,e.script?.clear(),d("status-change","default")});function A(){const M=m.value.replace(/\s+/g," ").trim();if(M!==g.value){if(g.value=M,e.script){const r=e.script.check(M||void 0);s.value=r?"correct":"wrong",d("status-change",s.value);return}s.value=Pe(M,i.yes_regexp,i.no_regexp,p.value)?"correct":"wrong",d("status-change",s.value)}}return(M,r)=>(l(),k("div",pt,[S("div",{class:R(["text-main-sm font-medium transition-[color]",c[s.value].labelClass])},[S("span",{onClick:r[0]||(r[0]=v=>b.value?.focus())},W(u.value),1)],2),S("form",{class:"flex",onSubmit:me(A,["prevent"])},[J(S("input",{ref:"answer","onUpdate:modelValue":r[1]||(r[1]=v=>m.value=v),type:"text",autocomplete:"off",placeholder:e.check.data.placeholder,class:R([`bg-bg-main text-main-sm focus:ring-brand relative z-10 min-w-0 flex-1
          rounded rounded-tr-none rounded-br-none border border-r-0 px-2.5 py-1
          ring-2 ring-transparent outline-0
          transition-[border,color,background,box-shadow]`,c[s.value].inputClass])},null,10,ht),[[pe,m.value]]),S("button",{type:"submit",class:R([`bg-bg-main relative w-[50px] cursor-pointer rounded rounded-tl-none
          rounded-bl-none border outline-0 transition-[border,color,background]`,c[s.value].buttonClass])},[(l(),x(f(w),{key:s.value,name:c[s.value].icon,class:R(["invisible m-auto text-[1.2em]",c[s.value].iconClass])},null,8,["name","class"])),V(f(o),null,{default:I(()=>[(l(),x(f(w),{key:s.value,name:c[s.value].icon,class:R(["absolute top-1/2 left-1/2 -translate-1/2 text-[1.2em]",c[s.value].iconClass])},null,8,["name","class"]))]),_:1})],2)],32),S("div",ft,W(h.value?f(_)(h.value):""),1)]))}}),bt={class:"micro:grid-cols-2 grid gap-(--proseAsideWidth) p-(--proseAsideWidth)"},gt=N({__name:"Checks",props:{value:{}},setup(e){let t=0;const a=new WeakMap;function n(u){return a.has(u)||a.set(u,`check-${++t}`),a.get(u)}function p(u,b){const m=[];for(const g of u){g._parent=b??null,m.push(g);const A=(g.children??[]).filter(M=>C(M,he));A.length&&m.push(...p(A,g))}return m}const d=D(()=>p(e.value.checkElements)),c=$({});function s(u,b){c.value[n(u)]=b}function _(u){const b=u._parent;if(!b)return!0;let m=b;for(;m;){if(c.value[n(m)]!=="correct")return!1;m=m._parent}return!0}const w=$({}),o=D(()=>{const u=new Map;for(const b of d.value)b.data.serializedValidator.type==="script"&&u.set(b,b.data.serializedValidator.name);return u});function i(u,b){if(!e.value.checkFunction)return console.warn("No check function defined for script checks!"),!1;const m=o.value.get(u),g=e.value.checkFunction({name:m,answer:b,answers:w.value});return g===!0?w.value[m]=b:delete w.value[m],g}function h(u){const b=o.value.get(u);b&&delete w.value[b]}return(u,b)=>(l(),x(te,null,{default:I(()=>[S("div",bt,[(l(!0),k(P,null,H(d.value,m=>J((l(),x(vt,{key:n(m),check:m,script:m.data.serializedValidator.type==="script"?{check:g=>i(m,g),clear:()=>h(m)}:void 0,onStatusChange:g=>s(m,g)},null,8,["check","script","onStatusChange"])),[[Te,_(m)]])),128))])]),_:1}))}}),kt={ref:"container"},_t={ref:"toggle",class:"select-none"},wt=["title"],xt=N({__name:"ProblemButtonGenerate",emits:["generate"],async setup(e,{emit:t}){let a,n;const p=t,{EruditTransition:d,EruditIcon:c,usePopup:s}=L(),_=$(Z),w=$(0),o=$(!1);function i(){w.value+=180,o.value?o.value=!1:_.value=Math.floor(Math.random()*1e6)+1,p("generate",_.value)}const h=([a,n]=z(()=>K()),a=await a,n(),a),u=G("container"),b=G("toggle"),m=G("popup"),{popupVisible:g,popupStyles:A}=s(u,b,m,{whileElementsMounted:Ze,placement:"top"});return(M,r)=>(l(),k("div",kt,[S("div",_t,[V(ke,{onClick:i,class:"flex items-center gap-[7px]"},{default:I(()=>[V(f(c),{name:f(be),style:se({transform:`rotate(${w.value}deg)`}),class:"text-[1.3em] transition-[transform] backface-hidden"},null,8,["name","style"]),S("span",null,W(f(h).action_generate),1)]),_:1})],512),V(f(d),null,{default:I(()=>[f(g)?(l(),k("div",{key:0,ref:"popup",style:se(f(A)),class:"pb-2.5"},[S("form",{class:"shadow-border text-main-xs flex rounded bg-neutral-900 text-white shadow-lg dark:bg-neutral-200 dark:text-black",onSubmit:me(i,["prevent"])},[J(S("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=v=>_.value=v),onInput:r[1]||(r[1]=v=>o.value=!0),title:f(h).seed_explain,onFocus:r[2]||(r[2]=v=>v.target.select()),class:"max-w-[100px] flex-1 p-[5px] text-center outline-none"},null,40,wt),[[pe,_.value]]),_.value!==f(Z)?(l(),k("button",{key:0,type:"button",onClick:r[3]||(r[3]=v=>{_.value=f(Z),o.value=!0,i()}),class:"cursor-pointer pr-[3px]"},[V(f(c),{name:f(ee),class:"hocus:text-white dark:hocus:text-black rotate-45 text-[1.3em] text-neutral-400 transition-[color] dark:text-neutral-600"},null,8,["name"])])):T("",!0)],32)],4)):T("",!0)]),_:1})],512))}}),yt={key:0,class:"gap-small micro:gap-normal flex flex-wrap p-(--proseAsideWidth) pt-0"},Rt=N({__name:"ProblemContent",props:{element:{},initialElements:{}},async setup(e){let t,a;const{EruditIcon:n}=L(),p=([t,a]=z(()=>K()),t=await t,a(),t),d=Object.fromEntries(Object.entries(Object.assign({"../assets/actions/answer.svg":Je,"../assets/actions/check.svg":ve,"../assets/actions/generate.svg":be,"../assets/actions/hint.svg":et,"../assets/actions/note.svg":tt,"../assets/actions/solution.svg":at})).map(([r,v])=>[r.split("/").pop()?.replace(".svg","")??r,v])),c=$(0),s=Y(e.initialElements),_=D(()=>s.value.find(r=>C(r,Ne))),w={check:gt,hint:dt,answer:Q,solution:Q,note:Q},o=D(()=>{const r={},v=s.value.filter(y=>C(y,he));v.length>0&&(r.check={checkElements:v,checkFunction:g.value});const E=s.value.filter(y=>C(y,oe));return E.length>0&&(r.hint=E),["answer","solution","note"].forEach(y=>{const q=s.value.filter(B=>{switch(y){case"answer":return C(B,ce.schema);case"solution":return C(B,le.schema);case"note":return C(B,re.schema)}});q.length>0&&(r[y]=q[0])}),r}),i=$(),h=Ve(s.value);de(()=>{const r=h.value;if(r===void 0)return;const v=s.value.at(r);switch(!0){case C(v,oe):i.value="hint";break;case C(v,ce.schema):i.value="answer";break;case C(v,le.schema):i.value="solution";break;case C(v,re.schema):i.value="note";break}});const u=Y(),b=([t,a]=z(()=>qe(e.element)),t=await t,a(),t),m=D(()=>!!u.value?.isGenerator),g=Y();De(async()=>{if(u.value=await nt(b?.resolvedScriptSrc,e.element.data.scriptUniques),u.value){const r=u.value.generate(Z);g.value=r.check}});let A=Z;async function M(r){if(!u.value)return;A=r;const v=u.value.generate(r);v.check&&(g.value=v.check);const E=v.problemContent,y=[];for(const q of E){const B=await Xe({rawProse:q});y.push(B.prose)}A===r&&(s.value=y,c.value++)}return(r,v)=>(l(),k("div",null,[(l(),x(X,{suspensible:""},{default:I(()=>[(l(),k("div",{class:"py-(--proseAsideWidth)",key:c.value},[(l(!0),k(P,null,H(_.value.children,E=>(l(),x(j,{element:E},null,8,["element"]))),256))]))]),_:1})),Object.values(o.value).some(Boolean)||m.value?(l(),k("div",yt,[(l(!0),k(P,null,H(o.value,(E,y)=>(l(),x(ke,{key:y,onClick:q=>i.value=y===i.value?void 0:y,active:y===i.value,class:"flex items-center gap-[7px]"},{default:I(()=>[V(f(n),{name:f(d)[y],class:"text-[1.3em]"},null,8,["name"]),S("span",null,W(f(p)[`action_${y}`]),1)]),_:2},1032,["onClick","active"]))),128)),m.value?(l(),x(xt,{key:0,onGenerate:M})):T("",!0)])):T("",!0),(l(),x(X,{suspensible:""},{default:I(()=>[i.value?(l(),x(He(w[i.value]),{key:`${c.value}-${i.value}`,value:o.value[i.value]},null,8,["value"])):T("",!0)]),_:1}))]))}});export{Rt as _,ke as a,K as u};
