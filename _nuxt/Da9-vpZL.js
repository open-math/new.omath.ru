import{_ as J}from"./CUZTy1QB.js";import{bd as Y,B as H,c as I,U as S,ai as Q,e as w,k as i,t as R,m as L,a as v,F as P,r as G,l as h,J as F,X as K,ao as X,Y as ee,h as r,am as te,Q as ne,Z as ae,x as C,y as se,G as re,aq as oe,ar as ie,be as le,bf as ce,ap as ue,g as M,n as B,f as A,v as b,K as me,S as de,R as fe,C as pe,a6 as _e,a5 as he,aa as ge,a9 as we,ak as xe}from"./Co3pHHec.js";import{_ as ve}from"./DU955r-L.js";const D={__JSPROSE_walkStop:!0},ye={};async function U(n,e){const s=await e(n);if(s===D)return D;if(s===ye)return;const t=n.children;if(t){for(const a of t.filter(Boolean))if(await U(a,e)===D)return D}}const Se=["datetime","title"],be={__name:"NuxtTime",props:{locale:{type:String,required:!1},datetime:{type:[String,Number,Date],required:!0},localeMatcher:{type:String,required:!1},weekday:{type:String,required:!1},era:{type:String,required:!1},year:{type:String,required:!1},month:{type:String,required:!1},day:{type:String,required:!1},hour:{type:String,required:!1},minute:{type:String,required:!1},second:{type:String,required:!1},timeZoneName:{type:String,required:!1},formatMatcher:{type:String,required:!1},hour12:{type:Boolean,required:!1,default:void 0},timeZone:{type:String,required:!1},calendar:{type:String,required:!1},dayPeriod:{type:String,required:!1},numberingSystem:{type:String,required:!1},dateStyle:{type:String,required:!1},timeStyle:{type:String,required:!1},hourCycle:{type:String,required:!1},relative:{type:Boolean,required:!1},numeric:{type:String,required:!1},relativeStyle:{type:String,required:!1},title:{type:[Boolean,String],required:!1}},setup(n){const e=n,s=Y()?.vnode.el,t=s?.getAttribute("datetime"),a=s?.getAttribute("data-locale"),c=H(),o=I(()=>{const d=e.datetime;return t&&c.isHydrating?new Date(t):e.datetime?new Date(d):new Date}),f=S(c.isHydrating&&window._nuxtTimeNow?new Date(window._nuxtTimeNow):new Date);if(e.relative){const p=setInterval(()=>{f.value=new Date},1e3);Q(()=>clearInterval(p))}const l=I(()=>{const{locale:d,relative:p,relativeStyle:_,...g}=e;return p?new Intl.RelativeTimeFormat(a??d,{...g,style:_}):new Intl.DateTimeFormat(a??d,g)}),x=I(()=>{if(!e.relative)return l.value.format(o.value);const d=(o.value.getTime()-f.value.getTime())/1e3,p=[{unit:"second",seconds:1,threshold:60},{unit:"minute",seconds:60,threshold:60},{unit:"hour",seconds:3600,threshold:24},{unit:"day",seconds:86400,threshold:30},{unit:"month",seconds:2592e3,threshold:12},{unit:"year",seconds:31536e3,threshold:1/0}],{unit:_,seconds:g}=p.find(({seconds:m,threshold:k})=>Math.abs(d/m)<k)||p[p.length-1],u=d/g;return l.value.format(Math.round(u),_)}),y=I(()=>o.value.toISOString()),N=I(()=>e.title===!0?y.value:typeof e.title=="string"?e.title:void 0),$={};return(d,p)=>(i(),w("time",L($,{datetime:y.value,title:N.value}),R(x.value),17,Se))}},Ne=v({__name:"Mix",props:{element:{}},setup(n){return(e,s)=>(i(!0),w(P,null,G(n.element.children,t=>(i(),h(O,{element:t},null,8,["element"]))),256))}}),ke=Object.assign(Ne,{__name:"AsideMinorNewsElementsMix"}),Te=v({__name:"P",props:{element:{}},setup(n){return(e,s)=>(i(),w("p",null,[(i(!0),w(P,null,G(n.element.children,t=>(i(),h(O,{element:t},null,8,["element"]))),256))]))}}),qe=Object.assign(Te,{__name:"AsideMinorNewsElementsP"}),Ie=v({__name:"Text",props:{element:{}},setup(n){const e=n.element.data,s=e.match(/^(\s*)/)?.[1]?" ":"",t=e.match(/(\s*)$/)?.[1]?" ":"",a=F(e),c=s+a+t,o=K(X,c);return(f,l)=>(i(),h(ee(r(o))))}}),Me=Object.assign(Ie,{__name:"AsideMinorNewsElementsText"}),De=v({__name:"Ref",props:{element:{}},setup(n){const{closePreview:e,setPreview:s}=te(),t=n.element.storageValue,a={timeout:void 0,startTimeout(){this.timeout=setTimeout(()=>{this.reset()},400)},reset(){clearTimeout(this.timeout),this.timeout=void 0}};function c(){if(a.timeout){a.reset(),e();const o=t.type==="direct"?t.resolvedHref:re(t.resolvedHref.slice(1));return window.open(o,"_blank"),!1}return s(t.previewRequest),a.startTimeout(),!1}return(o,f)=>{const l=ne;return i(),h(l,{onClickCapture:ae(c,["prevent"]),to:r(t).resolvedHref,style:{"--tGap":"1px","--xGap":"4px","--bGap":"4px"},class:"hocus:bg-(--linkColor)/15 relative -mx-[calc(var(--xGap)-3px)] -mt-(--tGap) -mb-(--bGap) rounded-sm bg-transparent px-(--xGap) pt-(--tGap) pb-(--bGap) text-(--linkColor) underline decoration-[color-mix(in_srgb,var(--linkColor)30%,transparent)] decoration-2 underline-offset-2 transition-[color,background]"},{default:C(()=>[se(R(("formatText"in o?o.formatText:r(F))(n.element.data.label)),1)]),_:1},8,["to"])}}}),Ce=Object.assign(De,{__name:"AsideMinorNewsElementsRef"}),Ae=v({__name:"RenderNewsElement",props:{element:{}},setup(n){const e=(()=>{switch(n.element.schemaName){case ue.name:return Me;case ce.name:return qe;case le.name:return Ce;case ie.name:case oe.name:return ke;default:return K("span",{class:"text-red-500 font-semibold font-mono"},`<${n.element.schemaName} />`)}})();return(s,t)=>n.element?(i(),h(r(e),{key:0,element:n.element},null,8,["element"])):M("",!0)}}),O=Object.assign(Ae,{__name:"AsideMinorNewsRenderNewsElement"}),$e={class:"p-normal border-border border-b text-sm transition-[border]"},Ee=v({__name:"NewsItem",props:{item:{},isNew:{type:Boolean}},async setup(n){let e,s;const t=new Date(n.item.date),a=new Date,c=(()=>{const l=new Date(a);return l.setMonth(a.getMonth()-3),t>=l&&t<=a})(),o={year:"numeric",month:"long",day:"numeric"},f=t.toLocaleDateString(void 0,o);return[e,s]=B(()=>U(n.item.content.proseElement,async l=>{if(l.storageKey){const x=l.storageKey;n.item.content.storage[x]!==void 0&&(l.storageValue=n.item.content.storage[x])}})),await e,s(),(l,x)=>{const y=me,N=be;return i(),w("div",$e,[A("div",{class:de(["mb-small gap-small flex items-center transition-[color]",n.isNew?"font-semibold text-orange-700 dark:text-orange-300":"text-text-muted"])},[n.isNew?(i(),h(y,{key:0,name:"flame",class:"text-[1.2em]"})):M("",!0),b(N,L({datetime:r(t)},o,{relative:r(c),title:r(f),class:"cursor-help"}),null,16,["datetime","relative","title"])],2),A("div",{style:fe({"--linkColor":n.isNew?"light-dark(var(--color-orange-700),var(--color-orange-300))":"var(--color-brand)"}),class:"gap-small flex flex-col text-[0.95em]"},[b(O,{element:n.item.content.proseElement},null,8,["element"])],4)])}}}),Be=Object.assign(Ee,{__name:"AsideMinorNewsItem"}),Re={class:"flex h-full w-full flex-col"},Pe={key:0},Ge=["disabled"],j="last-viewed-news-date",Oe=v({__name:"AsideMinorNews",async setup(n){let e,s;const t=S(0),a=S([]),c=S(new Set),o=S(),f=S(!1),l=H();function x(){return l.payload.data.news}function y(){l.payload.data.news={total:t.value||void 0,items:a.value,newIndices:Array.from(c.value),nextIndex:o.value}}function N(){return localStorage.getItem(j)}function $(u){localStorage.setItem(j,u)}async function d(u){f.value=!0;try{const m=await $fetch(`/api/news/batch/${u}`,{responseType:"json"});u===0&&(t.value=m.total,p(m.items)),a.value=a.value.concat(m.items),o.value=m.nextIndex,y()}catch(m){console.error("Error fetching news:",m)}finally{f.value=!1}}function p(u){if(u.length===0)return;const m=N(),k=u[0].date;if(m){const T=u.map((q,E)=>q.date>m?E:-1).filter(q=>q!==-1);T.length>0&&T.length<u.length&&(c.value=new Set(T))}$(k)}const _=x();_?(t.value=_.total||0,a.value=_.items,c.value=new Set(_.newIndices),o.value=_.nextIndex):([e,s]=B(()=>d(0)),await e,s());const g=([e,s]=B(()=>pe("news","no_news","show_more")),e=await e,s(),e);return(u,m)=>{const k=J,T=_e,q=we,E=ge,W=he,Z=ve;return i(),h(Z,null,{default:C(()=>[A("div",Re,[b(k,{icon:"bell",title:r(g).news,count:r(t)===0?void 0:r(t)},null,8,["title","count"]),r(a).length===0?(i(),w("section",Pe,[b(T,{text:r(g).no_news},null,8,["text"])])):M("",!0),b(W,{class:"flex-1"},{default:C(()=>[(i(!0),w(P,null,G(r(a),(V,z)=>(i(),h(Be,{item:V,isNew:r(c).has(z)},null,8,["item","isNew"]))),256)),b(E,null,{default:C(()=>[r(o)!==void 0?(i(),w("button",{key:0,onClick:m[0]||(m[0]=V=>d(r(o))),disabled:r(f),class:"my-big px-normal py-small bg-bg-accent hocus:border-text-disabled gap-normal m-auto flex w-auto cursor-pointer items-center rounded border-2 border-transparent text-sm transition-[border,background,color]"},[r(f)?(i(),h(q,{key:0,svg:"loadingSvg"in u?u.loadingSvg:r(xe)},null,8,["svg"])):M("",!0),A("span",null,R(r(g).show_more),1)],8,Ge)):M("",!0)]),_:1})]),_:1})])]),_:1})}}}),Le=Object.assign(Oe,{__name:"AsideMinorNews"});export{Le as default};
