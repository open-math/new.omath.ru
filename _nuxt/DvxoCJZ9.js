import{_ as J}from"./3X5y4Lih.js";import{bd as Y,B as L,U as S,ai as Q,k as i,e as w,t as P,m as H,c as I,a as y,F as R,r as G,l as h,J as F,X as K,ao as X,Y as ee,u as o,am as te,Q as ne,Z as ae,x as C,y as se,G as re,aq as oe,ar as ie,be as le,bf as ce,ap as ue,g as M,n as B,f as A,K as me,v as b,S as de,R as fe,C as pe,a6 as _e,a5 as he,aa as ge,bg as we}from"./DPlMRrvx.js";import{_ as xe}from"./C3OXdxRz.js";const D={__JSPROSE_walkStop:!0},ye={};async function U(n,e){const s=await e(n);if(s===D)return D;if(s===ye)return;const t=n.children;if(t){for(const a of t.filter(Boolean))if(await U(a,e)===D)return D}}const ve=["datetime","title"],Se={__name:"NuxtTime",props:{locale:{type:String,required:!1},datetime:{type:[String,Number,Date],required:!0},localeMatcher:{type:String,required:!1},weekday:{type:String,required:!1},era:{type:String,required:!1},year:{type:String,required:!1},month:{type:String,required:!1},day:{type:String,required:!1},hour:{type:String,required:!1},minute:{type:String,required:!1},second:{type:String,required:!1},timeZoneName:{type:String,required:!1},formatMatcher:{type:String,required:!1},hour12:{type:Boolean,required:!1,default:void 0},timeZone:{type:String,required:!1},calendar:{type:String,required:!1},dayPeriod:{type:String,required:!1},numberingSystem:{type:String,required:!1},dateStyle:{type:String,required:!1},timeStyle:{type:String,required:!1},hourCycle:{type:String,required:!1},relative:{type:Boolean,required:!1},numeric:{type:String,required:!1},relativeStyle:{type:String,required:!1},title:{type:[Boolean,String],required:!1}},setup(n){const e=n,s=Y()?.vnode.el,t=s?.getAttribute("datetime"),a=s?.getAttribute("data-locale"),c=L(),r=I(()=>{const m=e.datetime;return t&&c.isHydrating?new Date(t):e.datetime?new Date(m):new Date}),f=S(c.isHydrating&&window._nuxtTimeNow?new Date(window._nuxtTimeNow):new Date);if(e.relative){const p=setInterval(()=>{f.value=new Date},1e3);Q(()=>clearInterval(p))}const l=I(()=>{const{locale:m,relative:p,relativeStyle:_,...g}=e;return p?new Intl.RelativeTimeFormat(a??m,{...g,style:_}):new Intl.DateTimeFormat(a??m,g)}),x=I(()=>{if(!e.relative)return l.value.format(r.value);const m=(r.value.getTime()-f.value.getTime())/1e3,p=[{unit:"second",seconds:1,threshold:60},{unit:"minute",seconds:60,threshold:60},{unit:"hour",seconds:3600,threshold:24},{unit:"day",seconds:86400,threshold:30},{unit:"month",seconds:2592e3,threshold:12},{unit:"year",seconds:31536e3,threshold:1/0}],{unit:_,seconds:g}=p.find(({seconds:u,threshold:k})=>Math.abs(m/u)<k)||p[p.length-1],d=m/g;return l.value.format(Math.round(d),_)}),v=I(()=>r.value.toISOString()),N=I(()=>e.title===!0?v.value:typeof e.title=="string"?e.title:void 0),$={};return(m,p)=>(i(),w("time",H($,{datetime:v.value,title:N.value}),P(x.value),17,ve))}},be=y({__name:"Mix",props:{element:{}},setup(n){return(e,s)=>(i(!0),w(R,null,G(n.element.children,t=>(i(),h(O,{element:t},null,8,["element"]))),256))}}),Ne=Object.assign(be,{__name:"AsideMinorNewsElementsMix"}),ke=y({__name:"P",props:{element:{}},setup(n){return(e,s)=>(i(),w("p",null,[(i(!0),w(R,null,G(n.element.children,t=>(i(),h(O,{element:t},null,8,["element"]))),256))]))}}),Te=Object.assign(ke,{__name:"AsideMinorNewsElementsP"}),qe=y({__name:"Text",props:{element:{}},setup(n){const e=n.element.data,s=e.match(/^(\s*)/)?.[1]?" ":"",t=e.match(/(\s*)$/)?.[1]?" ":"",a=F(e),c=s+a+t,r=K(X,c);return(f,l)=>(i(),h(ee(o(r))))}}),Ie=Object.assign(qe,{__name:"AsideMinorNewsElementsText"}),Me=y({__name:"Ref",props:{element:{}},setup(n){const{closePreview:e,setPreview:s}=te(),t=n.element.storageValue,a={timeout:void 0,startTimeout(){this.timeout=setTimeout(()=>{this.reset()},400)},reset(){clearTimeout(this.timeout),this.timeout=void 0}};function c(){if(a.timeout){a.reset(),e();const r=t.type==="direct"?t.resolvedHref:re(t.resolvedHref.slice(1));return window.open(r,"_blank"),!1}return s(t.previewRequest),a.startTimeout(),!1}return(r,f)=>{const l=ne;return i(),h(l,{onClickCapture:ae(c,["prevent"]),to:o(t).resolvedHref,style:{"--tGap":"1px","--xGap":"4px","--bGap":"4px"},class:"hocus:bg-(--linkColor)/15 relative -mx-[calc(var(--xGap)-3px)] -mt-(--tGap) -mb-(--bGap) rounded-sm bg-transparent px-(--xGap) pt-(--tGap) pb-(--bGap) text-(--linkColor) underline decoration-[color-mix(in_srgb,var(--linkColor)30%,transparent)] decoration-2 underline-offset-2 transition-[background]"},{default:C(()=>[se(P(("formatText"in r?r.formatText:o(F))(n.element.data.label)),1)]),_:1},8,["to"])}}}),De=Object.assign(Me,{__name:"AsideMinorNewsElementsRef"}),Ce=y({__name:"RenderNewsElement",props:{element:{}},setup(n){const e=(()=>{switch(n.element.schemaName){case ue.name:return Ie;case ce.name:return Te;case le.name:return De;case ie.name:case oe.name:return Ne;default:return K("span",{class:"text-red-500 font-semibold font-mono"},`<${n.element.schemaName} />`)}})();return(s,t)=>n.element?(i(),h(o(e),{key:0,element:n.element},null,8,["element"])):M("",!0)}}),O=Object.assign(Ce,{__name:"AsideMinorNewsRenderNewsElement"}),Ae={class:"p-normal border-border border-b text-sm"},$e=y({__name:"NewsItem",props:{item:{},isNew:{type:Boolean}},async setup(n){let e,s;const t=new Date(n.item.date),a=new Date,c=(()=>{const l=new Date(a);return l.setMonth(a.getMonth()-3),t>=l&&t<=a})(),r={year:"numeric",month:"long",day:"numeric"},f=t.toLocaleDateString(void 0,r);return[e,s]=B(()=>U(n.item.content.proseElement,async l=>{if(l.storageKey){const x=l.storageKey;n.item.content.storage[x]!==void 0&&(l.storageValue=n.item.content.storage[x])}})),await e,s(),(l,x)=>{const v=me,N=Se;return i(),w("div",Ae,[A("div",{class:de(["mb-small gap-small flex items-center",n.isNew?"font-semibold text-orange-700 dark:text-orange-300":"text-text-muted"])},[n.isNew?(i(),h(v,{key:0,name:"flame",class:"text-[1.2em]"})):M("",!0),b(N,H({datetime:o(t)},r,{relative:o(c),title:o(f),class:"cursor-help"}),null,16,["datetime","relative","title"])],2),A("div",{style:fe({"--linkColor":n.isNew?"light-dark(var(--color-orange-700),var(--color-orange-300))":"var(--color-brand)"}),class:"gap-small flex flex-col text-[0.95em]"},[b(O,{element:n.item.content.proseElement},null,8,["element"])],4)])}}}),Ee=Object.assign($e,{__name:"AsideMinorNewsItem"}),Be={class:"flex h-full w-full flex-col"},Pe={key:0},Re=["disabled"],j="last-viewed-news-date",Ge=y({__name:"AsideMinorNews",async setup(n){let e,s;const t=S(0),a=S([]),c=S(new Set),r=S(),f=S(!1),l=L();function x(){return l.payload.data.news}function v(){l.payload.data.news={total:t.value||void 0,items:a.value,newIndices:Array.from(c.value),nextIndex:r.value}}function N(){return localStorage.getItem(j)}function $(d){localStorage.setItem(j,d)}async function m(d){f.value=!0;try{const u=await $fetch(`/api/news/batch/${d}`,{responseType:"json"});d===0&&(t.value=u.total,p(u.items)),a.value=a.value.concat(u.items),r.value=u.nextIndex,v()}catch(u){console.error("Error fetching news:",u)}finally{f.value=!1}}function p(d){if(d.length===0)return;const u=N(),k=d[0].date;if(u){const T=d.map((q,E)=>q.date>u?E:-1).filter(q=>q!==-1);T.length>0&&T.length<d.length&&(c.value=new Set(T))}$(k)}const _=x();_?(t.value=_.total||0,a.value=_.items,c.value=new Set(_.newIndices),r.value=_.nextIndex):([e,s]=B(()=>m(0)),await e,s());const g=([e,s]=B(()=>pe("news","no_news","show_more")),e=await e,s(),e);return(d,u)=>{const k=J,T=_e,q=we,E=ge,W=he,Z=xe;return i(),h(Z,null,{default:C(()=>[A("div",Be,[b(k,{icon:"bell",title:o(g).news,count:o(t)===0?void 0:o(t)},null,8,["title","count"]),o(a).length===0?(i(),w("section",Pe,[b(T,{text:o(g).no_news},null,8,["text"])])):M("",!0),b(W,{class:"flex-1"},{default:C(()=>[(i(!0),w(R,null,G(o(a),(V,z)=>(i(),h(Ee,{item:V,isNew:o(c).has(z)},null,8,["item","isNew"]))),256)),b(E,null,{default:C(()=>[o(r)!==void 0?(i(),w("button",{key:0,onClick:u[0]||(u[0]=V=>m(o(r))),disabled:o(f),class:"my-big px-normal py-small bg-bg-accent hocus:border-text-disabled gap-normal m-auto flex w-auto cursor-pointer items-center rounded border-2 border-transparent text-sm transition-[border]"},[o(f)?(i(),h(q,{key:0})):M("",!0),A("span",null,P(o(g).show_more),1)],8,Re)):M("",!0)]),_:1})]),_:1})])]),_:1})}}}),Le=Object.assign(Ge,{__name:"AsideMinorNews"});export{Le as default};
