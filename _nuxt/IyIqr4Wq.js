import{_ as F}from"./DHfkGO-S.js";import{W as p,N as r,O as _,a1 as C,a2 as $,a0 as d,ae as G,aS as O,aU as W,aT as q,ac as a,X,az as Y,Z as J,a5 as Q,ad as V,aX as Z,S as N,U as ee,Q as B,a as te,b5 as ne,bo as ae,aV as se,a4 as y,P as k,al as oe,R as x,aF as re,a3 as le,a7 as ce,a8 as P,ab as ie,bp as me,bq as ue,av as de,br as _e,Y as v,a9 as pe}from"./Du3Wvoik.js";import{_ as fe}from"./CaDfkTRa.js";import{_ as xe}from"./Crx8eIgn.js";import{a as we}from"./DKpbjkX5.js";const he=p({__name:"Mix",props:{element:{}},setup(e){return(n,l)=>(r(!0),_(C,null,$(e.element.children,o=>(r(),d(A,{element:o},null,8,["element"]))),256))}}),ge=Object.assign(he,{__name:"AsideMinorNewsElementsMix"}),be=p({__name:"P",props:{element:{}},setup(e){return(n,l)=>(r(),_("p",null,[(r(!0),_(C,null,$(e.element.children,o=>(r(),d(A,{element:o},null,8,["element"]))),256))]))}}),ve=Object.assign(be,{__name:"AsideMinorNewsElementsP"}),ye=p({__name:"Text",props:{element:{}},setup(e){const n=e.element.data,l=n.match(/^(\s*)/)?.[1]?" ":"",o=n.match(/(\s*)$/)?.[1]?" ":"",t=G(n),i=l+t+o,s=O(W,i);return(c,f)=>(r(),d(q(a(s))))}}),Ne=Object.assign(ye,{__name:"AsideMinorNewsElementsText"}),ke=p({__name:"Ref",props:{element:{}},setup(e){const n=X(),{closePreview:l,setPreview:o}=Y(),t=e.element.storageValue,i={timeout:void 0,startTimeout(){this.timeout=setTimeout(()=>{this.reset()},400)},reset(){clearTimeout(this.timeout),this.timeout=void 0}};function s(){if(i.timeout&&t.type!=="error"){i.reset(),l();const c=t.type==="external"?t.resolvedHref:n(t.resolvedHref.slice(1));return window.open(c,"_blank"),!1}return t.type==="error"||(o(t.previewRequest),i.startTimeout()),!1}return J(()=>{t.type==="error"&&console.warn(`Error in link element inside new item: ${t.error}`)}),(c,f)=>{const w=Q;return r(),d(w,{onClickCapture:Z(s,["prevent"]),to:a(t).type==="error"?void 0:a(t).resolvedHref,style:{"--tGap":"1px","--xGap":"4px","--bGap":"4px"},class:V([`relative -mx-[calc(var(--xGap)-3px)] -mt-(--tGap) -mb-(--bGap) rounded-sm
      bg-transparent px-(--xGap) pt-(--tGap) pb-(--bGap) underline decoration-2
      underline-offset-2 transition-[background]`,a(t).type==="error"?`hocus:bg-red-400/20 cursor-not-allowed text-red-600
          decoration-red-400/40 dark:text-red-400`:`hocus:bg-(--linkColor)/15 text-(--linkColor)
          decoration-[color-mix(in_srgb,var(--linkColor)30%,transparent)]`])},{default:N(()=>[ee(B(("formatText"in c?c.formatText:a(G))(e.element.data.label)),1)]),_:1},8,["to","class"])}}}),Me=Object.assign(ke,{__name:"AsideMinorNewsElementsRef"}),Te=p({__name:"RenderNewsElement",props:{element:{}},setup(e){const n=(()=>{switch(e.element.schema.name){case se.name:return Ne;case ae.name:return ve;case ne.name:return Me;case te.name:return ge;default:return O("span",{class:"text-red-500 font-semibold font-mono"},`<${e.element.schema.name} />`)}})();return(l,o)=>e.element?(r(),d(a(n),{key:0,element:e.element},null,8,["element"])):y("",!0)}}),A=Object.assign(Te,{__name:"AsideMinorNewsRenderNewsElement"}),Se={class:"p-normal border-border border-b text-sm"},Ce=p({__name:"NewsItem",props:{item:{},isNew:{type:Boolean}},setup(e){const n=new Date(e.item.date),l=new Date,o=(()=>{const s=new Date(l);return s.setMonth(l.getMonth()-3),n>=s&&n<=l})(),t={year:"numeric",month:"long",day:"numeric"},i=n.toLocaleDateString(void 0,t);return we(e.item.content.prose,s=>{if(s.storageKey){const c=s.storageKey;e.item.content.storage[c]!==void 0&&(s.storageValue=e.item.content.storage[c])}}),(s,c)=>{const f=oe,w=xe;return r(),_("div",Se,[k("div",{class:V(["mb-small gap-small flex items-center",e.isNew?"font-semibold text-orange-700 dark:text-orange-300":"text-text-muted"])},[e.isNew?(r(),d(f,{key:0,name:"flame",class:"text-[1.2em]"})):y("",!0),x(w,re({datetime:a(n)},t,{relative:a(o),title:a(i),class:"cursor-help"}),null,16,["datetime","relative","title"])],2),k("div",{style:le({"--linkColor":e.isNew?"light-dark(var(--color-orange-700),var(--color-orange-300))":"var(--color-brand)"}),class:"gap-small flex flex-col text-[0.95em]"},[x(A,{element:e.item.content.prose},null,8,["element"])],4)])}}}),$e=Object.assign(Ce,{__name:"AsideMinorNewsItem"}),Ae={class:"flex h-full w-full flex-col"},Ie={key:0},Ee=["disabled"],D="last-viewed-news-date",Pe=p({__name:"AsideMinorNews",async setup(e){let n,l;const o=v(0),t=v([]),i=v(new Set),s=v(),c=v(!1),f=ce();function w(){return f.payload.data.news}function R(){f.payload.data.news={total:o.value||void 0,items:t.value,newIndices:Array.from(i.value),nextIndex:s.value}}function j(){return localStorage.getItem(D)}function L(u){localStorage.setItem(D,u)}async function I(u){c.value=!0;try{const m=await pe(`/api/news/batch/${u}`);u===0&&(o.value=m.total,H(m.items)),t.value=t.value.concat(m.items),s.value=m.nextIndex,R()}catch(m){console.error("Error fetching news:",m)}finally{c.value=!1}}function H(u){if(u.length===0)return;const m=j(),T=u[0].date;if(m){const g=u.map((b,S)=>b.date>m?S:-1).filter(b=>b!==-1);g.length>0&&g.length<u.length&&(i.value=new Set(g))}L(T)}const h=w();h?(o.value=h.total||0,t.value=h.items,i.value=new Set(h.newIndices),s.value=h.nextIndex):([n,l]=P(()=>I(0)),await n,l());const M=([n,l]=P(()=>ie("news","no_news","show_more")),n=await n,l(),n);return(u,m)=>{const T=F,g=me,b=_e,S=de,U=ue,K=fe;return r(),d(K,null,{default:N(()=>[k("div",Ae,[x(T,{icon:"bell",title:a(M).news,count:a(o)===0?void 0:a(o)},null,8,["title","count"]),a(t).length===0?(r(),_("section",Ie,[x(g,{text:a(M).no_news},null,8,["text"])])):y("",!0),x(U,{class:"flex-1"},{default:N(()=>[(r(!0),_(C,null,$(a(t),(E,z)=>(r(),d($e,{item:E,isNew:a(i).has(z)},null,8,["item","isNew"]))),256)),x(S,null,{default:N(()=>[a(s)!==void 0?(r(),_("button",{key:0,onClick:m[0]||(m[0]=E=>I(a(s))),disabled:a(c),class:"my-big px-normal py-small bg-bg-accent hocus:border-text-disabled gap-normal m-auto flex w-auto cursor-pointer items-center rounded border-2 border-transparent text-sm transition-[border]"},[a(c)?(r(),d(b,{key:0})):y("",!0),k("span",null,B(a(M).show_more),1)],8,Ee)):y("",!0)]),_:1})]),_:1})])]),_:1})}}}),Re=Object.assign(Pe,{__name:"AsideMinorNews"});export{Re as default};
